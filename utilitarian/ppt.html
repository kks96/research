<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PPT Builder AI</title>
  <style>
:root{
  --bg: radial-gradient(1200px 600px at 20% -10%, #2b145a 0%, #0b0f1f 45%, #05060d 100%);
  --card: rgba(18, 18, 40, 0.72);
  --line: rgba(255,255,255,.10);

  --text: #eef0ff;
  --muted: rgba(230,235,255,.68);

  --bot: rgba(124, 58, 237, 0.16);
  --me: rgba(56, 189, 248, 0.14);

  --glow-purple: rgba(139,92,246,.65);
  --glow-blue: rgba(56,189,248,.45);

  --shadow: 0 10px 40px rgba(139,92,246,.22);
  --radius: 18px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

.wrap{max-width:900px;margin:0 auto;padding:16px}

.card{
  background: linear-gradient(180deg, rgba(30,30,70,.78), rgba(10,10,30,.78));
  backdrop-filter: blur(14px) saturate(140%);
  border: 1px solid rgba(255,255,255,.12);
  border-radius: var(--radius);
  box-shadow:
    0 0 0 1px rgba(139,92,246,.14),
    0 30px 90px rgba(0,0,0,.60);
  overflow:hidden;
  position: relative;

}

.header{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 14px;
  border-bottom: 1px solid rgba(255,255,255,.12);
  background: linear-gradient(135deg, rgba(139,92,246,.22), rgba(56,189,248,.14));
  position: relative;
}

.header::after{
  content:"";
  position:absolute;
  inset:-2px;
  pointer-events:none;
  background: linear-gradient(120deg, transparent 35%, rgba(255,255,255,.22), transparent 70%);
  opacity:.14;
}

.title{font-weight:800; letter-spacing:-0.2px;}
.subtitle{font-size:12px;color:var(--muted)}

.log{
  height:520px;
  overflow:auto;
  padding:14px;
  background:
    radial-gradient(900px 500px at 30% 0%, rgba(139,92,246,.14), transparent 60%),
    radial-gradient(900px 500px at 80% 20%, rgba(56,189,248,.10), transparent 55%),
    linear-gradient(to bottom, rgba(6,7,14,.65), rgba(6,7,14,.88));
}

.row{display:flex;gap:10px;margin:10px 0;align-items:flex-end}
.row.me{justify-content:flex-end}
.row > div{min-width:0}

.avatar{
  width:38px;height:38px;
  border-radius:50%;
  flex:0 0 auto;
  overflow:hidden;
  display:flex;align-items:center;justify-content:center;

  background: rgba(255,255,255,.04);
  border: 1px solid rgba(255,255,255,.16);

  box-shadow:
    0 0 0 1px rgba(139,92,246,.18),
    0 0 16px rgba(139,92,246,.35),
    0 0 26px rgba(56,189,248,.18);
}

.bubble{
  display:inline-block !important;

  /* âœ… ê°€ë¡œ ì¶©ë¶„íˆ í™•ë³´ */
  max-width: min(90%, 820px) !important;
  min-width: 180px;              /* â† ì´ê²Œ ì—†ìœ¼ë©´ hië„ ì°¢ì–´ì§ */

  padding:10px 12px !important;
  border-radius:14px !important;
  line-height:1.45 !important;

  /* âœ… ì¤„ë°”ê¿ˆ ê·œì¹™ (í•µì‹¬) */
  white-space: pre-wrap !important;
  word-break: normal !important;          /* âŒ ê¸€ì ë‹¨ìœ„ ê¸ˆì§€ */
  overflow-wrap: break-word !important;   /* â­• ë‹¨ì–´ ë‹¨ìœ„ë§Œ */
  letter-spacing: 0 !important;

  color: var(--text) !important;

  background:
    linear-gradient(160deg, rgba(255,255,255,.10), rgba(255,255,255,.03)) !important;
  border: 1px solid rgba(255,255,255,.14) !important;
  backdrop-filter: blur(8px);

  box-shadow:
    0 10px 24px rgba(0,0,0,.40),
    inset 0 0 14px rgba(139,92,246,.12);
}

@media (max-width: 480px){
  .bubble{
    max-width: 96% !important;
    min-width: 220px;   /* ëª¨ë°”ì¼ì—ì„œ íŠ¹íˆ ì¤‘ìš” */
  }
}
    
.bubble{
  word-break: break-word !important;
  overflow-wrap: anywhere !important;
  hyphens: auto;

  overflow: hidden !important;
}
.row.bot .bubble{
  background:
    linear-gradient(160deg, rgba(139,92,246,.22), rgba(255,255,255,.02)) !important;
  box-shadow:
    0 12px 28px rgba(139,92,246,.18),
    0 10px 24px rgba(0,0,0,.40),
    inset 0 0 16px rgba(139,92,246,.18);
}

.row.me .bubble{
  background:
    linear-gradient(160deg, rgba(56,189,248,.20), rgba(255,255,255,.02)) !important;
  box-shadow:
    0 12px 28px rgba(56,189,248,.16),
    0 10px 24px rgba(0,0,0,.40),
    inset 0 0 16px rgba(56,189,248,.14);
}

.meta{font-size:11px;color:var(--muted);margin-top:4px}

.composer{
  display:flex;
  gap:10px;
  padding:12px 14px;
  border-top:1px solid rgba(255,255,255,.12);
  background: rgba(10,10,22,.55);
  align-items:flex-end;
}

textarea.input{
  flex:1;
  padding:12px 14px;
  border-radius:16px;
  border: 1px solid rgba(255,255,255,.14);
  outline:none;
  font-size:14px;
  resize:none;
  line-height:1.4;
  min-height:48px;

  color: var(--text);
  background: rgba(255,255,255,.06);
  box-shadow: inset 0 0 0 1px rgba(139,92,246,.08);
}
textarea.input::placeholder{
  color: rgba(230,235,255,.45);
}

.btn{
  padding:12px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  cursor:pointer;
  font-weight:800;
  color:#fff;
  background: linear-gradient(135deg, rgba(139,92,246,.95), rgba(56,189,248,.92));
  box-shadow:
    0 0 0 1px rgba(255,255,255,.12),
    0 14px 34px rgba(139,92,246,.22);
}
.btn:hover{filter:brightness(1.06)}
.btn:disabled{opacity:.5;cursor:not-allowed}

.hint{padding:0 14px 12px;color:var(--muted);font-size:12px}
.smalllink{color:#c4b5fd;text-decoration:underline;cursor:pointer}

.typing{
  display:inline-flex;
  align-items:center;
  gap:4px;
  padding:10px 12px;
  border-radius:14px;
  background: rgba(139,92,246,.16);
  border:1px solid rgba(255,255,255,.12);
  backdrop-filter: blur(6px);
}
.dot{
  width:6px;height:6px;border-radius:999px;
  background: radial-gradient(circle, rgba(196,181,253,1), rgba(124,58,237,1));
  box-shadow: 0 0 10px rgba(139,92,246,.60);
  animation:bounce 1.05s infinite ease-in-out;
  opacity:.9
}
.dot:nth-child(2){animation-delay:.15s}
.dot:nth-child(3){animation-delay:.3s}
@keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.55}40%{transform:translateY(-6px);opacity:1}}

.actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}

/* =========================
   Action button overflow fix
   ========================= */
.actions{
  flex-wrap: wrap;
}

.actionBtn{
  max-width: 100%;
  min-width: 0;
  flex: 1 1 auto;          /* âœ… ë²„íŠ¼ì´ ì¤„ì–´ë“¤ ìˆ˜ ìˆê²Œ */
  white-space: normal;     /* âœ… í•œ ì¤„ ê³ ì • í•´ì œ */
  overflow-wrap: anywhere; /* âœ… ê¸´ ë‹¨ì–´ë„ ì¤„ë°”ê¿ˆ */
  word-break: break-word;  /* âœ… ì˜ë¬¸/URL ëŠê¸° */
}

@media (max-width: 480px){
  .actionBtn{ width: 100%; }
}
    
.actionBtn{
  padding:9px 12px;
  border-radius:999px;
  cursor:pointer;
  font-weight:800;

  color: var(--text);
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: 0 10px 22px rgba(0,0,0,.28);
}

.actionBtn.primary{
  color:#fff;
  background: linear-gradient(135deg, rgba(139,92,246,.95), rgba(56,189,248,.92));
  border: none;
  box-shadow: 0 14px 28px rgba(139,92,246,.20);
}
.actionBtn:hover{filter:brightness(1.05)}

.endedOverlay{
  position:absolute;
  inset:0;
  display:none; /* ê¸°ë³¸ì€ ìˆ¨ê¹€ */
  align-items:center;
  justify-content:center;
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(10px);
  z-index: 10;
}

.endedBox{
  padding:16px 18px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(18, 18, 40, 0.78);
  box-shadow: 0 20px 60px rgba(0,0,0,.55);
  text-align:center;
  max-width: 380px;
}

.endedTitle{
  font-weight:900;
  margin-bottom:6px;
}

.endedDesc{
  font-size:13px;
  color: rgba(230,235,255,.78);
}

@media (max-width: 480px){
  .wrap{
    transform: scale(0.92);
    transform-origin: top center;
  }
}

  /* iOS Safari/webview ëŒ€ë¹„: wrap ìì²´ë„ ì¶•ì†Œ + í­ ë³´ì • */
  .wrap{
    transform: scale(0.86);
    transform-origin: top center;
    width: calc(100% / 0.86);
    padding: 8px; /* ëª¨ë°”ì¼ì—ì„œ ì—¬ë°±ë„ ì•½ê°„ ì¤„ì„ */
  }

  /* (ì„ íƒ) ìŠ¤í¬ë¡¤ ì²´ê° ë” ì¤„ì´ê³  ì‹¶ìœ¼ë©´ log ë†’ì´ë„ ì•½ê°„ ì¤„ì´ê¸° */
  .log{
    height: 460px; /* 420~520 ì‚¬ì´ë¡œ ì·¨í–¥ ì¡°ì ˆ */
  }

  /* (ì„ íƒ) ë²„íŠ¼/ì…ë ¥ë„ ì¡°ê¸ˆ ì»´íŒ©íŠ¸í•˜ê²Œ */
  .composer{ padding: 10px 12px; }
  textarea.input{ font-size: 13px; min-height: 44px; }
  .btn{ padding: 10px 12px; }
}
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="header">
      <div class="avatar" id="botAvatar"></div>
      <div>
        <div class="title" id="botName">PPT Builder AI â€œGPPTâ€</div>
        <div class="subtitle" id="botDesc"></div>
      </div>
      <!-- Exit ì—†ìŒ -->
    </div>

    <div class="log" id="log"></div>

    <div class="endedOverlay" id="endedOverlay">
      <div class="endedBox">
        <div class="endedTitle">âœ… This chat has ended</div>
        <div class="endedDesc">Thanks for using GPPT. Come back anytime ğŸ˜Š</div>
      </div>
    </div>

    <div class="composer">
      <textarea class="input" id="msg" rows="2"
        placeholder='Enter = send, Shift+Enter = new line&#10;You can try: "Help me create a PPT about AI business"'></textarea>
      <button class="btn" id="send" type="button">Send</button>
    </div>

    <div class="hint">
      <span class="smalllink" id="reset">(Reset)</span>
    </div>
  </div>
</div>

<script>
(function () {
  const BOT = {
    name: "PPT Builder AI â€œGPPTâ€",
    avatarSvg: `
      <svg viewBox="0 0 64 64" width="38" height="38" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#a5b4fc"/>
            <stop offset="1" stop-color="#60a5fa"/>
          </linearGradient>
        </defs>
        <rect width="64" height="64" rx="32" fill="url(#g)"/>
        <circle cx="32" cy="36" r="18" fill="#fff" opacity="0.92"/>
        <circle cx="25" cy="34" r="2.8" fill="#111827"/>
        <circle cx="39" cy="34" r="2.8" fill="#111827"/>
        <path d="M26 41c2.5 3 9.5 3 12 0" fill="none" stroke="#111827" stroke-width="2.2" stroke-linecap="round"/>
        <path d="M18 25c6-8 22-10 28 0" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round" opacity="0.85"/>
      </svg>`
  };

  const elBotAvatar = document.getElementById("botAvatar");
  const elBotName = document.getElementById("botName");
  const elBotDesc = document.getElementById("botDesc");
  const log = document.getElementById("log");
  const msg = document.getElementById("msg");
  const send = document.getElementById("send");
  const reset = document.getElementById("reset");
  const endedOverlay = document.getElementById("endedOverlay");

  if (!elBotAvatar || !elBotName || !log || !msg || !send || !reset) return;

  elBotAvatar.innerHTML = BOT.avatarSvg;
  elBotName.textContent = BOT.name;
  if (elBotDesc) elBotDesc.textContent = ""; // í•„ìš”í•˜ë©´ ë„£ê¸°

  // âœ… 3ì¢… íŒŒì¼ ë“±ë¡
  const PPT_FILES = {
    executive: { url: "https://kks96.github.io/research/utilitarian/executive.pptx", filename:"executive.pptx", label:"AI Executive Briefing" },
    roadmap:   { url: "https://kks96.github.io/research/utilitarian/roadmap.pptx",   filename:"roadmap.pptx",   label:"AI Roadmap" },
    pitch:     { url: "https://kks96.github.io/research/utilitarian/pitch.pptx",     filename:"pitch.pptx",     label:"Pitch Deck" }
  };

  // âœ… ì–´ë–¤ íŒŒì¼ì„ ì œê³µí–ˆëŠ”ì§€ ê¸°ë¡
  const provided = new Set(); // "executive" | "roadmap" | "pitch"

  let typingRowEl = null;
  let awaitingContinueAfterThanks = false;

  function nowTime(){
    const d = new Date();
    return `${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
  }

  function normalize(text){
    return (text || "").trim().replace(/\s+/g, " ").toLowerCase();
  }

  function downloadFile(url, filename){
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.rel = "noopener";
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  function addRow({who, text, actions=[]}){
    const row = document.createElement("div");
    row.className = "row " + (who === "me" ? "me" : "bot");

    if(who === "bot"){
      const av = document.createElement("div");
      av.className = "avatar";
      av.innerHTML = BOT.avatarSvg;
      row.appendChild(av);
    }

    const wrap = document.createElement("div");
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.textContent = text;

    if(who === "bot" && actions.length){
      const actionsEl = document.createElement("div");
      actionsEl.className = "actions";

      actions.forEach(a => {
        const b = document.createElement("button");
        b.className = "actionBtn " + (a.type === "download" ? "primary" : "");
        b.textContent = a.label;
        b.onclick = () => {
          if(a.type === "download") {
            downloadFile(a.url, a.filename);
          }
          if(a.type === "choice") {
            addRow({who:"me", text: a.label});
            respond("@choice:" + (a.value || a.label));
          }
        };
        actionsEl.appendChild(b);
      });

      bubble.appendChild(actionsEl);
    }

    wrap.appendChild(bubble);

    const meta = document.createElement("div");
    meta.className = "meta";
    meta.textContent = nowTime();
    wrap.appendChild(meta);

    row.appendChild(wrap);
    log.appendChild(row);
    log.scrollTop = log.scrollHeight;
  }

  function showTyping(){
    if(typingRowEl) return;

    const row = document.createElement("div");
    row.className = "row bot";

    const av = document.createElement("div");
    av.className = "avatar";
    av.innerHTML = BOT.avatarSvg;

    const typing = document.createElement("div");
    typing.className = "typing";
    typing.innerHTML = `<span class="dot"></span><span class="dot"></span><span class="dot"></span>`;

    row.appendChild(av);
    row.appendChild(typing);
    typingRowEl = row;
    log.appendChild(row);
    log.scrollTop = log.scrollHeight;
  }

  function showGenerating(text = "Making PPT for you..."){
    if(!typingRowEl) showTyping();
    if(!typingRowEl) return;

    const typingBox = typingRowEl.querySelector(".typing");
    if(!typingBox) return;

    let label = typingBox.querySelector(".genLabel");
    if(!label){
      label = document.createElement("span");
      label.className = "genLabel";
      label.style.marginLeft = "8px";
      label.style.color = "rgba(230,235,255,.78)";
      label.style.fontSize = "12px";
      label.style.fontWeight = "700";
      label.style.whiteSpace = "nowrap";
      typingBox.appendChild(label);
    }
    label.textContent = text;
  }

  let chatEnded = false;

  function hideTyping(){
    if(!typingRowEl) return;
    typingRowEl.remove();
    typingRowEl = null;
  }

  function containsBadLanguage(t){
    const bad = ["fuck","shit","bitch","asshole","bastard","nigger","chink","kike","fag","retard","sex","stupid"];
    return bad.some(w => t.includes(w));
  }

  function containsDisallowedRequest(t){
    const risky = [
      "how to make a bomb","make a bomb","buy drugs","sell drugs",
      "kill myself","suicide","self harm",
      "porn","nude","sex with","rape",
      "hack","ddos","phishing","steal password"
    ];
    return risky.some(w => t.includes(w));
  }

  function pickRandomTemplate(){
    const keys = Object.keys(PPT_FILES);
    const remaining = keys.filter(k => !provided.has(k));
    const pool = remaining.length ? remaining : keys;
    const k = pool[Math.floor(Math.random() * pool.length)];
    return { key: k, file: PPT_FILES[k] };
  }

  function handleChoice(choiceValue){
    const v = normalize(choiceValue);
    let key = null;

    if(v.includes("executive")) key = "executive";
    else if(v.includes("roadmap")) key = "roadmap";
    else if(v.includes("pitch")) key = "pitch";
    else if(v.includes("download")) key = "download";

    if(key === "download"){
      const picked = pickRandomTemplate();
      const file = picked.file;
      provided.add(picked.key);

      return {
        text: `Done â€” hereâ€™s a template for you (random pick).\nDownload it and edit as needed:`,
        actions: [{ label: `Download PPTX`, type: "download", url: file.url, filename: file.filename }]
      };
    }

    if(key && PPT_FILES[key]){
      const file = PPT_FILES[key];
      provided.add(key);

      const label =
        key === "executive" ? "Executive briefing" :
        key === "roadmap"   ? "AI roadmap" :
        "Pitch deck";

      return {
        text: `Great â€” Iâ€™ll set it up as: ${label}.\n\nHere is the PPT file that you asked! Download it and edit as needed:`,
        actions: [{ label: `Download PPTX`, type: "download", url: file.url, filename: file.filename }]
      };
    }

    return { text: `I couldn't map your selection. Type "help" to see options.`, actions: [] };
  }

  function mapTypedChoiceToValue(t){
    const aliases = [
      { value: "executive", keys: ["executive briefing", "executive", "briefing", "exec briefing", "exec"] },
      { value: "roadmap",   keys: ["ai roadmap", "roadmap", "ai road map", "road map"] },
      { value: "pitch",     keys: ["pitch deck", "pitch", "pitching", "investor pitch"] },
      { value: "download",  keys: ["download", "template", "starter deck", "starter", "just download a template"] }
    ];
    for(const a of aliases){
      if(a.keys.includes(t)) return a.value;
    }
    return null;
  }

  async function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

  const RULES = [
    {
      id: "ask_name",
      patterns: [/what('?s| is) your name\??/i, /who are you\??/i, /your name\??/i],
      reply: () => ({
        text: `My name is GPPT.
Iâ€™m a scenario-based PPT helper â€” I can:
â€¢ Provide a starter PPT template (download)
â€¢ Suggest slide structure for executive briefing / roadmap / pitch
â€¢ Turn your topic into clear slide titles + key bullets`,
        actions: [
          { label: "Executive briefing", type: "choice", value: "executive" },
          { label: "AI roadmap", type: "choice", value: "roadmap" },
          { label: "Pitch deck", type: "choice", value: "pitch" },
          { label: "Just download a template", type: "choice", value: "download" }
        ]
      })
    },
    {
      id: "capabilities",
      patterns: [
        /what can you do\??/i,/function\??/i,/option\??/i,/options\??/i,
        /show me what you can\??/i,/what is your function\??/i,/show me your function\??/i,
        /how can you help\??/i,/^help$/i,/^hep$/i,/^hel$/i,/^hlp$/i,
        /^help me$/i,/^hep me$/i,/^hel me$/i,/^hlp me$/i,/commands/i
      ],
      reply: () => ({
        text: `Hereâ€™s what I can do:
1) Give you a starter PPT template (download)
2) Recommend a deck format (executive / roadmap / pitch)
3) Provide a slide-by-slide outline for your topic

Pick one to continue:`,
        actions: [
          { label: "Executive briefing", type: "choice", value: "executive" },
          { label: "AI roadmap", type: "choice", value: "roadmap" },
          { label: "Pitch deck", type: "choice", value: "pitch" },
          { label: "Just download a template", type: "choice", value: "download" }
        ]
      })
    },
    {
      id: "greeting",
      patterns: [/^hi$/i,/^hello$/i,/^hey$/i,/^yo$/i,/^sup$/i,/^good (morning|afternoon|evening)$/i],
      reply: () => ({
        text: `I'm really glad to meet you ğŸ˜‰!

What do you need? For now, I can help you with:
â€¢ A starter template
â€¢ An executive briefing outline
â€¢ A roadmap deck structure
â€¢ A pitch deck structure`,
        actions: [
          { label: "Executive briefing", type: "choice", value: "executive" },
          { label: "AI roadmap", type: "choice", value: "roadmap" },
          { label: "Pitch deck", type: "choice", value: "pitch" },
          { label: "Just download a template", type: "choice", value: "download" }
        ]
      })
    },
    {
      id: "thanks",
      patterns: [/^thanks!?$/i, /^thank you!?$/i, /thx/i, /^thank$/i],
      reply: () => {
        awaitingContinueAfterThanks = true;
        return ({
          text: `Youâ€™re welcome ğŸ‘Œ
Do you want me to help you with a further deck format or starter template?`,
          actions: [
            { label: "Executive briefing", type: "choice", value: "executive" },
            { label: "AI roadmap", type: "choice", value: "roadmap" },
            { label: "Pitch deck", type: "choice", value: "pitch" },
            { label: "Just download a template", type: "choice", value: "download" }
          ]
        });
      }
    },
    {
      id: "provide_deck",
      patterns: [
        /(download|get|give|send|provide).*(ppt|powerpoint|slides|deck|template)/i,
        /help me (create|make|build|prepare|draft).*(ppt|powerpoint|slides|deck)/i,
        /(ppt|powerpoint|slides|deck|slide).*(template|starter|example|sample)/i,
        /(create|powerpoint|slides|deck|slide).*(ppt|powerpoint|slides|deck|template|starter|example|sample)/i,
        /(make|powerpoint|slides|deck|slide).*(ppt|powerpoint|slides|deck|template|starter|example|sample)/i,
        /(build|powerpoint|slides|deck|slide).*(ppt|powerpoint|slides|deck|template|starter|example|sample)/i,
        /(ai|artificial intelligence).*(business|strategy|future|roadmap).*(ppt|powerpoint|deck|slides|slide)/i,
        /(ai|artificial intelligence).*(ppt|powerpoint|deck|slides|template|example|sample|slide)/i,
        /(ppt|powerpoint|deck|slides|template|example|sample|slide)/i,
        /(ppt|powerpoint|deck|slides).*(ai|artificial intelligence)/i
      ],
      reply: () => ({
        text: `Sure! What kind of PPT do you want? These are the samples.`,
        actions: [
          { label: "Executive briefing", type: "choice", value: "executive" },
          { label: "AI roadmap", type: "choice", value: "roadmap" },
          { label: "Pitch deck", type: "choice", value: "pitch" },
          { label: "Just download a template", type: "choice", value: "download" }
        ]
      })
    }
  ];

  const FALLBACKS = [
    `Sorry ğŸ˜… I didnâ€™t fully understand. Could you tell me a little more detail?

For example, you can say:
â€¢ "Download a PowerPoint template"
â€¢ "Help me create a PPT about AI business"
â€¢ Or type "help" to see options.`,
    `Sorry â€” can you clarify what kind of PPT you want?

Try:
â€¢ Say "download template"
â€¢ Or type "help" to see options.`
  ];

  function matchRule(userText){
    for(const r of RULES){
      if(r.patterns.some(rx => rx.test(userText))) return r;
    }
    return null;
  }

  async function respond(userText){
    if(chatEnded) return;

    showTyping();
    const delay = 350 + Math.floor(Math.random()*650);
    await sleep(delay);
    hideTyping();

    if(userText && userText.startsWith("@choice:")){
      const choiceValue = userText.slice("@choice:".length);

      showGenerating("Making PPT for you...");
      await sleep(5000);
      hideTyping();

      const out = handleChoice(choiceValue);
      addRow({who:"bot", text: out.text, actions: out.actions});
      return;
    }

    const t = normalize(userText);

    if (awaitingContinueAfterThanks) {
      const noPatterns = [
        /^no$/i, /^nope$/i, /^nah$/i, /^no thanks$/i, /^okay$/i, /^that's okay$/i,
        /^fine$/i, /^I'm fine$/i, /^I'm good$/i, /^it's enough$/i, /^no thank you$/i
      ];

      if (noPatterns.some(rx => rx.test(userText.trim()))) {
        awaitingContinueAfterThanks = false;
        addRow({
          who: "bot",
          text: `Got it ğŸ˜Š Thanks for using GPPT.
Whenever you need help, just come back and ask â€” Iâ€™ll be here!`
        });

        msg.disabled = true;
        send.disabled = true;
        msg.placeholder = "This chat has ended.";
        return;
      }
      awaitingContinueAfterThanks = false;
    }

    const mapped = mapTypedChoiceToValue(t);
    if(mapped){
      showGenerating("Making PPT for you...");
      await sleep(5000);
      hideTyping();

      const out = handleChoice(mapped);
      addRow({who:"bot", text: out.text, actions: out.actions});
      return;
    }

    if (containsBadLanguage(t) || containsDisallowedRequest(t)) {
      addRow({
        who: "bot",
        text: `I canâ€™t help with that request.

If you want, I can help you with:
â€¢ Creating a PPT outline (executive / roadmap / pitch)
â€¢ Providing a starter template for download
â€¢ Turning your topic into slide titles + key bullets`,
        actions: [
          { label: "Executive briefing", type: "choice", value: "executive" },
          { label: "AI roadmap", type: "choice", value: "roadmap" },
          { label: "Pitch deck", type: "choice", value: "pitch" },
          { label: "Just download a template", type: "choice", value: "download" }
        ]
      });
      return;
    }

    if(t.length <= 2 || t === "ok" || t === "k" || t === "?"){
      addRow({who:"bot", text: `Hi! How can I help you? You can type "help" to see options, or say "download template"ğŸ‘.`});
      return;
    }

    const rule = matchRule(userText);
    if(rule){
      const out = rule.reply(userText);
      addRow({who:"bot", text: out.text, actions: out.actions || []});
      return;
    }

    addRow({who:"bot", text: FALLBACKS[Math.floor(Math.random()*FALLBACKS.length)]});
  }

  async function onSend(){
  // âœ… ì¤„ë°”ê¿ˆì€ ìœ ì§€ (Shift+Enter ì…ë ¥ë„ ê·¸ëŒ€ë¡œ)
  const text = (msg.value || "")
    .replace(/\t+/g, " ")
    .replace(/\r/g, "")          // ìœˆë„ìš° CRë§Œ ì œê±°
    .trimEnd();                  // ë ê³µë°±ë§Œ ì •ë¦¬ (ì•ìª½ì€ ìœ ì§€)

  if(!text.trim()) return;

  addRow({who:"me", text});
  msg.value = "";
  msg.focus();

  send.disabled = true;
  try{ await respond(text); }
  finally{ send.disabled = false; }
}

  msg.addEventListener("keydown", (e) => {
    e.stopPropagation();
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      e.stopPropagation();
      onSend();
    }
  });

  send.addEventListener("click", onSend);

  reset.addEventListener("click", () => {
    log.innerHTML = "";

    chatEnded = false;
    msg.disabled = false;
    send.disabled = false;
    msg.placeholder = 'Enter = send, Shift+Enter = new line\nYou can try: "Help me create a PPT about AI business"';

    if(endedOverlay) endedOverlay.style.display = "none";
    provided.clear();
    addRow({who:"bot", text: "Reset complete. Type 'help' or ask for a template."});
  });

  addRow({
    who:"bot",
    text: `Hi! I'm GPPT ğŸ‘‹â€” your AI PPT helper.
Tell me what kind of deck you want, or type "help" to see buttons.

Example: "Help me create a PowerPoint about AI business"`
  });

})();
</script>
</body>
</html>
